# Optional

我们在写程序时一定都遇到过 ```空指针异常```。它通常发生在你试图去引用一个没有被初始化，被初始化为空或者没有指向任何实例的对象的情况下。***空仅仅只是意味着没有值***，最有可能的是，罗马人是唯一没有遇到过空，从 1 开始计数 1,2,3...（没有0） 的人，或许，他们没有模拟市场上没有苹果的情况。[:-)]

“我叫它价值十亿美元的错误” —— [Sir C. A. R. Hoare](https://en.wikipedia.org/wiki/Tony_Hoare)，他在提出空引用这个概念时说。

在本文中，我将讨论 [java 8 新特性](https://howtodoinjava.com/category/java-8/) 中 [Optional](https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html) 的具体用法。为了阐明诸多概念之间的异同，本文将被划分为多个部分一一讲解。	

	讨论的要点

	1）什么是空类型？
	2）返回一个空值有什么问题？
	3）Java8中的Optional类提供了一种怎样的解决办法？
     a）创建一个Optional对象
	 b）有了一个值对它进行操作
     c）默认或者缺省的值和行为
     d）使用过滤器方法拒绝一些特殊值
    4）Optional内部是如何工作的？
    5）Optional是用来解决什么问题的？
    6）Optional不能解决什么问题？
	7）Optional如何使用呢？
	8）最后的结论

1）什么是Null类型？

在java中，我们通过引用类型去访问一个对象，当我们的的引用没有指向一个具体的对象，我们就会把这个引用置为Null，用于标识该引用没有值，对吧？

虽然null值的使用如此普遍，但是我们很少会去仔细地研究它。例如一个类的成员变量会被自动初始化为null，程序员通常会给没有初始值的引用类型置null，总体上说，null值主要用于我们不知道具体的或者没有具体指向的引用类型。

    补充，在java中，null是一个具体而又特殊的数据类型，因为它没有名字，所以我们声明一个类型为null的变量或者将一个类型
    强转为null；实际上，仅仅有一个能和null有关联的值（例如。。。）。请记住，null不像java中的其他类型，一个空引用能
    完全正确，安全地赋给其他的引用类型，而且不报任何错。


2）返回null值有什么问题？

通常来说，API的设计者会附上详细的文档，并说明在某种情况下，这个API会返回一个null值，现在问题是，因为一些原因，我们在调用API的时候可能不会去读API文档，然后就忘记了处理null值的情况，这在未来一定会是一个bug。

相信我，这是经常发生的，而且是空指针异常的主要原因之一，虽然并不是唯一的原因。因此，请牢记，在第一次调用API时看看它的文档说明（。。至少）[:-)]。

    现在我们知道了在大多数情况下，null值是一个问题，那么处理null值最好的方式是什么呢？

一个比较好的解决方案是在定义引用类型时总是去将它初始化为某个值，并且不要初始化为null。采用这种方式，你的程序永远不会抛出 ```空指针异常``` 。但是有些情况下，引用并没有一个默认的初始值，那么我们又该怎么去处理呢？

上述的答案都是正确的，而且在很多时候被使用。但是，Java 8 ```Optionals``` 无疑是最好的答案。

3）Java 8的Optionals提供了一种怎样的解决方案？

Optional提供了一种可以替代一个指向非空值但是可以为空T的方法。一个Optional类或许包含了一个指向非空变量的引用（这种情况下我们说这个引用是Present的），或者什么也没包含（这种情况下我们说这个引用是absent）。

请记住，永远不要说optional包含null
	

    Optional<Integer> canBeEmpty1 = Optional.of(5);
	canBeEmpty1.isPresent();                    // returns true
	canBeEmpty1.get();                          // returns 5
	 
	Optional<Integer> canBeEmpty2 = Optional.empty();
	canBeEmpty2.isPresent();                    // returns false

我们可以看到 **Optional作为保存单变量的容器，既可以保存值，也可以不保存值。**

必须要指出Optional类并不是为了简单地去替代每一个null引用。它的出现是为了**帮助设计更易于理解的API**，以便我们只需要读方法的声明，就能分辨是否是一个Optional变量。这迫使你去捕获Optional中的变量，然后处理它，同时也处理optional为空的情形。这才是解决因为空引用导致的 ```NullPointerException```。

下面是一些学习在编程中如何使用Optional的例子。
